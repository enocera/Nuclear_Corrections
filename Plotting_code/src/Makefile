#############################################################################
# 									    #
# Makefile to compile and link FORTRAN programs                             #
#  									    #
# "make" compiles and links the specified main programs and modules,        #
# using the specified libraries (if any), and produces the executables      #
#									    #
# "make clean" removes all files generated by "make"                        #
#                                                                           #
#############################################################################

all: rmxeq mkxeq
.PHONY: all

# main programs to be compiled 

MAIN = DSSZ_test relunc xPDFs
MODULES = DSSZ-bandgen

############################## do not change #############################

SHELL=/bin/bash

FF=gfortran

LDFLAGS = -O3 
LDFLAGS += -Wunused
LDFLAGS += $(shell lhapdf-config --ldflags)
#LDFLAGS += -pg
#LDFLAGS += -mcmodel=medium

FLINKER=$(FF) 

PGMSF= $(MAIN) $(MODULES)

-include $(addsuffix .d,$(PGMS))

# rule to compile source programs

$(addsuffix .o,$(PGMSF)): %.o: %.f Makefile
	$(FF) $< -c $(LDFLAGS) 

# rule to link object files

$(MAIN): %: %.o  $(addsuffix .o,$(MODULES)) Makefile
	$(FLINKER) $< $(addsuffix .o,$(MODULES)) $(LDFLAGS) -o $@

# produce executables

mkxeq: $(MAIN)

# remove old executables

rmxeq:
	@ -rm -f $(MAIN); \
        echo "delete old executables"		

# clean directory 

clean:
	@ -rm -rf *.o *~ $(MAIN)
.PHONY: clean

############################################################################
